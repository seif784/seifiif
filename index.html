<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>سجلات الحضور</title>
  <style>
    body { font-family: sans-serif; background:#f9f9f9; padding:16px; }
    .record { padding:8px; margin:6px 0; background:#fff; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,.1); }
  </style>
</head>
<body>
  <h2 id="empHeader">سجلات الموظف</h2>
  <div id="empRecords">⏳ جاري التحميل...</div>

  <script type="module">
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";

    const app = initializeApp({ 
      apiKey: "AIzaSyAF9nwrWjUwdSs2P12L3B4hOnY4EfXwbDc",
      authDomain: "broker-94a9d.firebaseapp.com",
      databaseURL: "https://broker-94a9d-default-rtdb.firebaseio.com",
      projectId: "broker-94a9d",
      storageBucket: "broker-94a9d.appspot.com",
      messagingSenderId: "1084195654856",
      appId: "1:1084195654856:web:f2f442380c37dda7b769fd",
      measurementId: "G-BPMF7PRG0G"
    });
    const db = getDatabase(app);

    const urlParams = new URLSearchParams(window.location.search);
    const empCode = urlParams.get("emp");

    document.getElementById("empHeader").innerText = `سجلات الموظف (${empCode})`;

    async function loadRecords() {
      if (!empCode) return;
      const snap = await get(ref(db, "attendance"));
      if (!snap.exists()) {
        document.getElementById("empRecords").innerText = "لا توجد بيانات";
        return;
      }

      let html = "";
      snap.forEach(daySnap => {
        const day = daySnap.key;
        const rec = daySnap.val()[empCode];
        if (rec) {
          html += `
            <div class="record">
              <strong>${day}</strong><br>
              دخول: ${rec.checkIn?.time || "-"} (${rec.checkIn?.status || "-"})<br>
              خروج: ${rec.checkOut?.time || "-"} (${rec.checkOut?.status || "-"})
            </div>
          `;
        }
      });
      document.getElementById("empRecords").innerHTML = html || "لا توجد سجلات";
    }

    loadRecords();
  </script>
</body>
</html>
